<!DOCTYPE html>
<html>
<head>
  <title>Races</title> 
    <%= render "shared/navbar_races" %>
</head>
<body style="padding-top: 60px">
  <div class="container-fluid">
    <table class="table table-hover table-bordered">
      <thead>
      <tr>
        <th>Date</th>
        <th>Racer Count</th>
        <% if current_user and current_user.admin? %>
        <th>Actions</th>
        <% end %>
      </tr>
      </thead>
      <tbody>
      <% @races.joins(:results).group("race_id").count(:race_id).sort_by { |k| k[0]}.reverse.each do |result| %>
        <tr>
          <td><%= link_to Race.find(result[0]).date, race_path(Race.find(result[0])) %></td>
          <td><%= result[1] %></td>
          <% if current_user and current_user.admin? %>
            <td><%= link_to 'Edit', race_path(Race.find(result[0])) %> | <%= link_to 'Destroy',
                  race_path(Race.find(result[0])), method: :delete, data: { confirm: 'Are you sure you want to delete ' + Race.find(result[0]).date.to_s + '?'  } %></td>
          <% end %>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</body>
</html>