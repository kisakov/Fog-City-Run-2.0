<!DOCTYPE html>
<html>
<head>
  <title>Races</title> 
</head>
<nav class="navbar navbar-default navbar-fixed-top">
  <a class="navbar-brand" href="<%= root_path %>"><b>Fog City Run</b> </a>
  <ul class="nav navbar-nav">
    <li class="nav-item">
      <a class="nav-link" <%= link_to "Home", root_path %></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" <%= link_to 'Racers', racers_path %></a>
    </li>
    <li class="nav-item active">
      <a class="nav-link" href="#">Races</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" <%= link_to 'Racer Count', count_path %></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" <%= link_to 'Records', records_path %></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" <%= link_to 'Loop-Beer-Loop', loop_beer_path %></a>
    </li>
    <% if current_user.admin? %>
    <li class="nav-item">
      <a class="nav-link" <%= link_to 'Import', '/import' %></a>
    </li>
    <% end %>
  </ul>
  <form class="navbar-form navbar-left" role="search">
    <div class="input-group">
      <%= form_tag(races_path, :method => "get", id: "search-form") do %>
        <%= text_field_tag :search, params[:search], placeholder: "Search races...", class: 'form-control' %>
        <span class="input-group-btn">
          <%= submit_tag "Search", class: "btn btn-default" %>
        </span>
        <% end %>
    </div>
  </form>
  <%= render "shared/login" %>
</nav>
<body style="padding-top: 60px">
<div class="container-fluid">
    <table class="table table-hover table-bordered">
      <thead>
      <tr>
        <th>Date</th>
        <th>Racer Count</th>
      </tr>
      </thead>
      <tbody>
      <% @races.joins(:results).group("race_id").count(:race_id).sort_by { |k| k[0]}.reverse.each do |result| %>
        <tr>
          <td><%= link_to Race.find(result[0]).date, race_path(Race.find(result[0])) %></td>
          <td><%= result[1] %></td>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</body>
</html>