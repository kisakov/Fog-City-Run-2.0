<div class="panel panel-default" id="start_items_panel">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" 
      data-target="#start_items_table"
      href="#start_items_table">
          Entrants (<%= @start_items_length %>)
      </a>
    </h4>
  </div>
  <% if @show_start_items %>
    <div id="start_items_table" class="panel-collapse collapse.in">
  <% else %>
    <div id="start_items_table" class="panel-collapse collapse">
  <% end %>
    <div class="panel-body">
      <table class="table table-hover table-bordered sortable">
        <thead>
        <tr>
          <th>Bib</th>
          <th>Group</th>
          <th>Name</th>
          <th>Stop </th>
          <% if !@race_in_progess %>
          <th>Action</th>
          <% end %>
        </tr>
        </thead>
        <tbody>
        <% @start_items.each do |item| %>
          <tr>
            <td><%= item.bib %></td>
            <td><%= item.group %></td>
            <td><%= Racer.find(item.racer_id).first_name %> <%= Racer.find(item.racer_id).last_name %></td>
            <% if (current_user and current_user.racer_id == item.racer_id) or (current_user and current_user.admin?) %>
              <% if @race_in_progess and !item.finished %>
                <td><%= link_to 'Stop', collect_time_path(item), method: :post, :class => "btn btn-default" %></td>
              <% elsif @race_in_progess and item.finished %>
                <td>
                <%= link_to 'Finished', collect_time_path(item), method: :post, :class => "btn btn-danger disabled" %>
                <%= link_to 'Continue', continue_time_path(item), method: :post, :class => "btn btn-default" %>
                </td>
              <% elsif !@race_in_progess and item.finished %>
                <td><button class="btn btn-default">Finished</button></td>
              <% else %>
                <td><button class="btn btn-default">Not started</button></td>
              <% end %>
              <% if !@race_in_progess %>
                <td><%= link_to 'Edit', edit_start_item_path(item), :class => "btn btn-default" %> <%= link_to 'Destroy', start_item_path(item), method: :delete, data: { confirm: 'Are you sure you want to delete this start entry.'}, :class => "btn btn-default" %></li></td>
              <% end %>
            <% else %>
              <td><%= link_to 'Stop', collect_time_path(item), method: :post, :class => "btn btn-default disabled" %></td>
              <% if !@current_race %>
                <td><%= link_to 'Edit', edit_start_item_path(item), :class => "btn btn-default disabled" %> <%= link_to 'Destroy', start_item_path(item), method: :delete, data: { confirm: 'Are you sure you want to delete this start entry.'}, :class => "btn btn-default disabled" %></li></td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
        </tbody>
      </table>
      <div class="row text-center">
        <!-- Admin + User with racer_id -->
        <% if current_user and current_user.admin? and @is_current_race %>
          <%= link_to 'Register Racer', new_start_item_path(:race_id => @race.id), :class => "btn btn-default" %>
        <% end %>
        <!-- Admin + User without racer_id -->
        <% if current_user and current_user.racer_id and @is_current_race and !@current_user_registered %>
          <%= link_to 'Register Yourself', new_start_item_path(:race_id => @race.id, :racer_id => current_user.racer_id), :class => "btn btn-default" %>
        <% elsif current_user and current_user.racer_id and @is_current_race and @current_user_registered %>
          <%= link_to 'Already registered', new_start_item_path(:race_id => @race.id, :racer_id => current_user.racer_id), :class => "btn btn-default disabled" %>
        <% elsif @is_current_race %>
          Please log in.
        <% end %>
        <% if current_user and current_user.admin? and !@race_in_progess and @is_current_race %>
          <%= link_to 'Start', start_race_path(), method: :put, :class => "btn btn-default" %>
        <% elsif current_user and current_user.admin? and @race_in_progess %>
          <%= link_to 'Stop Race', stop_race_path(), method: :put, :class => "btn btn-default" %>
        <% end %>
      </div>
    </div>
  </div>
</div>